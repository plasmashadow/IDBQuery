function DataBase(a){var b=this;void 0===window.IDBDriver&&(window.IDBDriver=this),b.version=2,b.DB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,b.dbname=a,this.tables=[],b.Listeners={},this.createSchemas=function(){var a=b.tables,c=b.DB.open(b.dbname,b.version);c.onsuccess=function(c){var d=c.target.result,e=parseInt(d.version);console.log(e),d.close(),b.version=b.version+1;var f=b.DB.open(b.dbname,e+1);console.log(e+1),f.onupgradeneeded=function(b){var c=b.target.result;if(a.hasOwnProperty("length"))a.forEach(function(a){var b=c.createObjectStore(a.tabel.name,{keyPath:a.tabel.getPrimaryKey().name});a.tabel.properties.forEach(function(a){a.key?b.createIndex(a.name,a.name,{unique:!0}):b.createIndex(a.name,a.name,{unique:!1})})});else{var d=c.createObjectStore(a.tabel.name,{keyPath:a.tabel.getPrimaryKey().name});a.tabel.forEach(function(a){a.key?d.createIndex(a.name,a.name,{unique:!0}):d.createIndex(a.name,a.name,{unique:!1})})}},f.onsuccess=function(a){a.target.result.close()}}}}function Property(a,b){this.name=a,this.type=b,this.complement=!1,this.isAuto=!1,this.values=[]}function Schema(a){var b=this;if(b.data=a,function(){try{var a=0;b.tablename=b.data.name?b.data.name:"SchemaUndefined",b.tabel=new Table(b.tablename),b.data.properties&&b.data.properties.forEach(function(c){var d=new Property(c.name,c.type);if(void 0==d.type)throw d;c.key&&c.auto?(d.setKey(!0),a++):c.key&&(d.setKey(!1),a++),b.tabel.add(d),1>=a&&(d.code=1)}),b.data.foreignKeys&&window.tables.forEach(function(a){b.data.foreignKeys.forEach(function(c){c.name===a.name&&b.tabel.addRelation(a)})})}catch(c){switch(c.code){case 1:return void console.log("Table cannot have more than one primary key")}console.log(c)}return!0}(b.data),!b.tabel.getPrimaryKey()){var c=new Property(b.tabel.name+"_id","number");c.setKey(!0),b.tabel.add(c)}window.tables.push(b.tabel),console.log(b.tabel)}function Table(a){this.name=a,this.properties=[],this.foreignKeys=[],this.values=[],this.currentptr=0,this.references=[]}function Process(a,b){this.process=a;var c=window.URL;return this.blob=c.createObjectURL(new Blob(["(",a,").apply(null,",b,")"],{type:"application/javascript"})),this.blob}function Thread(){this.tasks=[],this.jobs=[]}function Util(a,b,c){this.dbname=a,this.tablename=b,this.version=c,this.results=[],this.flag=!1,this.queried=[]}function TableUtil(a,b,c){this.dbname=a,this.tablename=b,this.version=c}function Condition(){var a=this;a.kwargs={},a.args=arguments}function Iterator(a){this.list=a,this.currentposition=0;var b=this;b.list.hasOwnProperty("length")?b.length=b.list.length-1:(b.list=[b.list],b.length=0)}function Deferred(){this._done=[],this._fail=[]}function Condition(a){var b=this;b.value=a}function Collections(){this.args=arguments,this.sequence={},this.sequence.gt=">",this.sequence.lt="<",this.sequence.ge=">=",this.sequence.le="<=",this.sequence.eq="=="}function Task(a,b){this.job=a,this.job.started=!1,this.job.paused=!1,this.job.stopped=!1,this.job.end=!1,this.arg=b,this.result=void 0}function SemaPhore(){this.timeout=200,this.tasks=[],this.activity={}}DataBase.prototype={addTable:function(a){var b=new Schema(a);this.tables.push(b)},Initialize:function(){this.createSchemas()},OnSave:function(){},OnDelete:function(){},getTable:function(a){var b;for(var c in this.tables){var d=this.tables[c];d.tabel.name==a&&(b=d.tabel)}return b},Save:function(a,b){var c=this.dbname,d=this.version,e={},f=this;e.eventorigin=a;try{var g=this.getTable(a),h=g.getPrimaryKey().name;h in b?(console.log("at else"),(b[h]>=g.currentptr+1||b[h]<=g.currentptr-1)&&(console.log("at else if"),b[h]=g.currentptr+1,g.currentptr=g.currentptr+1)):(b[h]=g.currentptr+1,console.log("at if"),g.currentptr=g.currentptr+1);var i,j=g.getForeignKeys();if(j.length>0){for(var k in j)for(var l in j[k]){i=new Util(c,j[k][l],d);{i.isThere(b[l])}}setTimeout(function(){if(!i.flag)throw b;e.data=b,console.log(b),g.put(b),f.Store(g.name),f.OnSave(e)},100)}else e.data=b,console.log(b),g.put(b),f.Store(g.name),f.OnSave(e)}catch(m){console.error(m.toString()),console.log("Error Commiting to database")}},Store:function(a){var b=this.getTable(a);for(console.log("Storing on "+this.version+"of database");b.values.length>0;){var c=new Util(this.dbname,a,this.version),d=b.values.shift();console.log(d),c.add(d)}},Query:function(a,b,c){var d=this;switch(d.queryresult=[],void 0===c&&(c=function(){}),b){case"object":var e=new Util(d.dbname,a,d.version),f=d.getTable(a);e.getObjects(f,function(a){console.log("on get object callback"),d.queryresult.push(a),c(a)});break;case"relation":var e=new Util(d.dbname,a,d.version),f=d.getTable(a);e.getRelational(f,function(a){d.queryresult.push(a),c(a)})}},get:function(a,b,c){var d=this;d.queryresult=[];var e=new TableUtil(d.dbname,a,d.version);e.onGetObject=function(a){d.queryresult.push(a),c(a)},e.getObject(b)},addListener:function(a,b){var c=this,d=c.Listeners[a];switch(void 0==d&&(c.Listeners[a]=b),a){case"save":c.OnSave=b;break;case"delete":c.OnDelete=b}},Delete:function(a,b){function c(){var a=e.tablename,b=e.relations,c=e.keyid,d=f.getTable(a).getPrimaryKey().name;b.length>0&&b.forEach(function(a){var b=f.getTable(a).getPrimaryKey().name;f.Query(a,"relation",function(e){e[d]==c&&(g.Delete(a,e[b]),console.log("deleted"),console.log(e))})})}var d,e,f=this,g=new Util(f.dbname,a,f.version),h=f.getTable(a);f.get(a,b,function(f){d=f,e={tablename:a,relations:h.references,keyid:b},g.Delete(a,b),c()})},Filter:function(a,b,c){var d=[],e=this;switch(b){case"eq":for(var f=0;f<e.queryresult.length;f++)e.queryresult[f][a]==c&&d.push(e.queryresult[f]);break;case"lt":for(var f=0;f<e.queryresult.length;f++)e.queryresult[f][a]<c&&d.push(e.queryresult[f]);break;case"le":for(var f=0;f<e.queryresult.length;f++)e.queryresult[f][a]<=c&&d.push(e.queryresult[f]);break;case"ge":for(var f=0;f<e.queryresult.length;f++)e.queryresult[f][a]>=c&&d.push(e.queryresult[f])}return e.queryresult=d,e},GetResultSet:function(){return this.queryresult}},Property.prototype={put:function(a){try{if(this.type!=typeof a)throw a;this.values.push(a)}catch(b){console.log("Prototype Mismatch "+b)}},setKey:function(a){a?(this.isAuto=!0,this.complement=!0):this.complement=!0},get:function(a){return this.values[a]},toString:function(){console.log(this.name+"  "+this.type+" "+this.values)}},window.tables=[],Table.prototype={current:0,add:function(a){this.properties.push(a)},getPrimaryKey:function(){for(var a=0;a<this.properties.length;a++)if(this.properties[a].complement)return this.properties[a]},addRelation:function(a){this.foreignKeys.push(a);try{if(!a.getPrimaryKey())throw a;a.references.push(this.name);var b=Object.create(a.getPrimaryKey());b.relation=a.name,b.complement=!1,b.isAuto=!1,this.properties.push(b)}catch(c){console.log("The table doesn't have a primary key",c.name)}},toString:function(){console.log(this.name+" "+this.properties+" "+this.foreignKeys+" "+this.values)},put:function(a){try{var b=!1,c=this.properties;for(var d in a)c.forEach(function(c){if(d===c.name){if(c.type!==typeof a[d])throw a;b=!0}});b&&this.values.push(a)}catch(e){console.log(e)}},getForeignKeys:function(){var a=[];return this.foreignKeys.forEach(function(b){var c={};c[b.getPrimaryKey().name]=b.name,a.push(c)}),a},"delete":function(a,b){a["delete"](this.name,b)}},Thread.prototype={addTask:function(a,b){var c=Process(a,b);this.tasks.push(c)},start:function(){this.tasks.forEach(function(a){worker=new Worker(a)})}},Util.prototype.add=function(a){console.log("the current version of database is "+this.version);var b=a,c=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,d=c.open(this.dbname,this.version),e=this.tablename;d.onerror=function(){console.error("error opening the database")},d.onsuccess=function(a){var c=a.target.result,d=c.transaction(e,"readwrite"),f=d.objectStore(e);f.put(b)}},Util.prototype.query=function(){},Util.prototype.read=function(a,b){var c=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,a=(c.open(this.dbname,this.version),this.tablename),d=this;d.readColoumn(a,b)},Util.prototype.Condition=function(){},Util.prototype.readColoumn=function(a,b){var c=this;c.resultsbycolumns={},void 0===b?(c.onDataAdded=function(){c.results.forEach(function(a){console.log(a)})},c.GetAll()):(c.resultsbycolumns[b]=[],c.onDataAdded=function(){c.results.forEach(function(a){c.resultsbycolumns[b].push(a[b])})},c.GetAll())},Util.prototype.onDataAdded=function(){console.log(this.results)},Util.prototype.GetAll=function(a){this.results=[];var b=this.results,c=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,d=c.open(this.dbname,this.version),a=this.tablename,e=this.onDataAdded;d.onerror=function(){console.error("error opening the database for reading")},d.onsuccess=function(c){var d=c.target.result,f=d.transaction(a,"readwrite");console.log(a);var g=f.objectStore(a);g.openCursor().onsuccess=function(a){var c=a.target.result;c?(b.push(c.value),c["continue"]()):(console.log("cursor has done"),e())}}},Util.prototype.isThere=function(a){var b,c=this,d=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,e=d.open(this.dbname,this.version),f=this.tablename;e.onerror=function(){console.log("error opening the database")},e.onsuccess=function(c){var d=c.target.result,e=d.transaction(f,"readwrite"),g=e.objectStore(f);b=g.get(a)},setTimeout(function(){c.flag=void 0!==b.result?!0:!1},100)},Util.prototype.getObjects=function(a,b,c){var d=this;d.resultsbycolumns={};var e=a.getForeignKeys();void 0===b&&(b=function(){}),void 0===c?(d.onDataAdded=e.length>0?function(){console.log("on channel event"),d.results.forEach(function(a){console.log("under result ");for(var c in a){console.log(c);for(var f in e)if(c in e[f]){console.log(c+"is foreignkeys");var g=new TableUtil(d.dbname,e[f][c],d.version);g.onGetObject=function(e){a[c]=e,d.queried.push(a),b(a)},g.getObject(a[c])}}})}:function(){d.results.forEach(function(a){d.queried.push(a),b(a)})},d.GetAll()):(d.resultsbycolumns[c]=[],d.onDataAdded=function(){},d.GetAll())},Util.prototype.getRelational=function(a,b,c){var d=this;d.queried=[],void 0===b&&(b=function(){}),void 0===c&&(d.onDataAdded=function(){console.log("got into on channel event"),d.results.forEach(function(a){d.queried.push(a),b(a)})},d.GetAll())},Util.prototype.Delete=function(a,b){var c=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,d=c.open(this.dbname,this.version);d.onsuccess=function(c){var d=c.target.result,e=d.transaction(a,"readwrite"),f=e.objectStore(a);console.log(typeof b),f["delete"](b)},d.onerror=function(){}},Util.prototype.Search=function(a,b,c){var d=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,e=d.open(this.dbname,this.version);e.onsuccess=function(d){var e=d.target.result,f=e.transaction(a,"readwrite"),g=f.objectStore(a),h=g.index(b);h.openCursor().onsuccess=function(a){var b=a.target.result;if(b){var d={key:b.key,object:b.value};c(d),b["continue"]()}}},e.onerror=function(){console.error("ERROR WHILE OPENING THE DATABASE FOR SEARCHING WITHOUT ANY CONDITION")}},Util.prototype.getBy=function(a,b,c,d){var e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,f=e.open(this.dbname,this.version);f.onsuccess=function(e){var f=e.target.result,g=f.transaction(a,"readwrite"),h=g.objectStore(a),i=h.index(b);i.openCursor().onsuccess=function(a){var b=a.target.result;if(b){if(b.key==c){var e={key:b.key,object:b.value};d(e)}b["continue"]()}}},f.onerror=function(){console.error("ERROR WHILE OPENING THE DATABASE FOR SEARCHING WITHOUT ANY CONDITION")}},TableUtil.prototype={onGetObject:function(a){console.log(a)},getObject:function(a){this.indexDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.request=this.indexDB.open(this.dbname,this.version);var b=this;b.request.onsuccess=function(c){console.log("getting inside onsuccess event");var d=c.target.result,e=d.transaction(b.tablename,"readwrite"),f=e.objectStore(b.tablename);b.val=f.get(a)},b.request.onerror=function(){console.log("error has occured")},setTimeout(function(){b.onGetObject(b.val.result)},100)},onDeleteObj:function(){},DeleteObj:function(){this.indexDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.request=this.indexDB.open(this.dbname,this.version)}},Condition.prototype={},Iterator.prototype.hasNext=function(){var a=this,b=!1;return void 0!==a.list[a.currentposition+1]&&null!==a.list[a.currentposition+1]&&(b=!0),b},Iterator.prototype.Next=function(){var a=this,b=a.currentposition;return a.currentposition=a.currentposition+1,a.list[b]},Iterator.prototype.Prev=function(){var a=this,b=a.currentposition-1;return a.list[b]},Iterator.prototype.IterateOver=function(a,b){function c(){b(d.list[d.currentposition]),d.hasNext()?d.Next():a(d.list)}var d=this;(null==b||void 0==b)&&(b=function(){}),d.list.forEach(function(){c()})},Deferred.prototype={execute:function(a,b){var c=a.length;for(console.log(a),b=Array.prototype.slice.call(b),console.log(b);c--;)a[c].apply(null,b)},resolve:function(a){this.execute(this._done,a)},reject:function(a){this.execute(this._fail,a)},done:function(a){this._done.push(a)},fail:function(a){this._fail.push(a)}},Condition.prototype={isLesserThan:function(a){return this.val<a},isGreaterThan:function(a){return this.val>a},isEqualto:function(a){return this.value==a},isGreaterAndEqual:function(a){return this.value>=a},isLesserAndEqual:function(a){return this.value<=a}},Collections.prototype={Max:function(a){return void 0!=a?Math.max.apply(null,this.args[a]):Math.max.apply(null,this.args)},Min:function(a){return void 0!=a?Math.min.apply(null,this.args[a]):Math.min.apply(null,this.args)},Map:function(a){for(var b=[],c=0;c<this.args.length;c++)b.push(a(this.args[c]));return b},Pluck:function(a){var b=[];return this.args.forEach(function(c){b.push(c[a])}),b},getBy:function(fieldname,conditiontype,value){var operation;if(void 0==this.sequence[conditiontype])throw"Condition not Present";operation=this.sequence[conditiontype];var values=[];return this.args.forEach(function(arg){eval(arg+operation+value)&&values.push(arg)}),values}},Task.prototype={execute:function(){this.job.apply(this,this.arg),this.OnEnd()},OnEnd:function(){this.job.end=!0},Oncomplete:function(a){this.job.end=!0,a()},checkOnComplete:function(){for(;;);},pause:function(){this.job.paused=!0},stop:function(){this.job.stopped=!0},start:function(){this.job.started=!0,this.execute()}},SemaPhore.prototype={addTask:function(a,b){var c=new Task(a,b);this.tasks.push(c)},start:function(){var a=this;for(var b in this.tasks)for(a.tasks[b].execute();;)if(this.tasks[b].job.end)break}};